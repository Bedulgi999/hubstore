<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>로그인 처리중...</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <main class="page">
    <div class="container" style="padding:60px 16px; text-align:center;">
      <div class="card pad" style="max-width:520px;margin:0 auto;">
        <h2 style="margin:0 0 10px;">로그인 처리중...</h2>
        <p class="muted" style="margin:0;" id="msg">세션 확인 중...</p>
      </div>
    </div>
  </main>

  <script type="module">
    import { supabase } from "/supabase.js";

    // 1) OAuth 콜백 URL에서 세션 읽기
    const { data, error } = await supabase.auth.getSession();
    if (error) console.error(error);

    // 2) 혹시 세션이 바로 안 잡히는 경우를 대비해 한번 더
    const session = data?.session || (await supabase.auth.getSession()).data?.session;

    if (!session) {
      document.getElementById("msg").textContent =
        "세션을 못 찾았어요. Supabase Redirect URL 설정을 확인해줘.";
      console.log("No session. URL:", location.href);
      // 2초 뒤 login으로
      setTimeout(() => location.href = "/login.html", 2000);
    } else {
      document.getElementById("msg").textContent = "로그인 완료! 홈으로 이동중...";
      // 3) 깔끔하게 홈으로
      location.href = "/index.html";
    }
  </script>
</body>
</html>
